<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>(Very) basic steps to weight a survey sample</title>
  <meta name="description" content="(Very) basic steps to weight a survey sample">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="(Very) basic steps to weight a survey sample" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="JosepER/Book_How_to_weight_a_survey" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="(Very) basic steps to weight a survey sample" />
  
  
  

<meta name="author" content="Josep Espasa Reig">


<meta name="date" content="2017-06-29">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="introduction.html">
<link rel="next" href="design-weights.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to the introduction on how to weight a survey sample!</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#aim-of-this-guide-and-further-readings"><i class="fa fa-check"></i><b>1.1</b> Aim of this guide and further readings</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#basic_steps"><i class="fa fa-check"></i><b>1.2</b> Basic steps in weighting a survey</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="import-data-management.html"><a href="import-data-management.html"><i class="fa fa-check"></i><b>2</b> Import data and data management</a><ul>
<li class="chapter" data-level="2.0.1" data-path="import-data-management.html"><a href="import-data-management.html#import-data"><i class="fa fa-check"></i><b>2.0.1</b> Import data</a></li>
<li class="chapter" data-level="2.0.2" data-path="import-data-management.html"><a href="import-data-management.html#select-variables"><i class="fa fa-check"></i><b>2.0.2</b> Select variables</a></li>
<li class="chapter" data-level="2.0.3" data-path="import-data-management.html"><a href="import-data-management.html#merging-datafiles"><i class="fa fa-check"></i><b>2.0.3</b> Merging datafiles</a></li>
<li class="chapter" data-level="2.0.4" data-path="import-data-management.html"><a href="import-data-management.html#recoding"><i class="fa fa-check"></i><b>2.0.4</b> Recoding</a></li>
<li class="chapter" data-level="2.1" data-path="import-data-management.html"><a href="import-data-management.html#exploring-and-presenting-the-dataset"><i class="fa fa-check"></i><b>2.1</b> Exploring and presenting the dataset</a><ul>
<li class="chapter" data-level="2.1.1" data-path="import-data-management.html"><a href="import-data-management.html#paradata-variables"><i class="fa fa-check"></i><b>2.1.1</b> Paradata variables</a></li>
<li class="chapter" data-level="2.1.2" data-path="import-data-management.html"><a href="import-data-management.html#survey-responses"><i class="fa fa-check"></i><b>2.1.2</b> Survey responses</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="design-weights.html"><a href="design-weights.html"><i class="fa fa-check"></i><b>3</b> Step 1: Design weights</a></li>
<li class="chapter" data-level="4" data-path="nonresponse-weights.html"><a href="nonresponse-weights.html"><i class="fa fa-check"></i><b>4</b> Step 2: Non-response weights</a><ul>
<li class="chapter" data-level="4.1" data-path="nonresponse-weights.html"><a href="nonresponse-weights.html#what-are-of-non-response-weights"><i class="fa fa-check"></i><b>4.1</b> What are of non-response weights?</a></li>
<li class="chapter" data-level="4.2" data-path="nonresponse-weights.html"><a href="nonresponse-weights.html#estimating-response-propensities-using-logistic-regression"><i class="fa fa-check"></i><b>4.2</b> Estimating response propensities using logistic regression</a></li>
<li class="chapter" data-level="4.3" data-path="nonresponse-weights.html"><a href="nonresponse-weights.html#creating-non-response-adjustment-classes"><i class="fa fa-check"></i><b>4.3</b> Creating non-response adjustment classes</a></li>
<li class="chapter" data-level="4.4" data-path="nonresponse-weights.html"><a href="nonresponse-weights.html#testing-non-response-adjustment-classes"><i class="fa fa-check"></i><b>4.4</b> Testing non-response adjustment classes</a></li>
<li class="chapter" data-level="4.5" data-path="nonresponse-weights.html"><a href="nonresponse-weights.html#propensity_adjustment"><i class="fa fa-check"></i><b>4.5</b> Propensity adjustment (alternative to adjustment classes)</a><ul>
<li class="chapter" data-level="4.5.1" data-path="nonresponse-weights.html"><a href="nonresponse-weights.html#estimating-response-propensities-using-cross-validated-lasso-regression"><i class="fa fa-check"></i><b>4.5.1</b> Estimating response propensities using Cross-validated LASSO Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="calibration.html"><a href="calibration.html"><i class="fa fa-check"></i><b>5</b> Step 3: Use of auxiliary data for weight calibration</a><ul>
<li class="chapter" data-level="5.1" data-path="calibration.html"><a href="calibration.html#preparing-data-for-calibration"><i class="fa fa-check"></i><b>5.1</b> Preparing data for calibration</a></li>
<li class="chapter" data-level="5.2" data-path="calibration.html"><a href="calibration.html#implementing-calibration"><i class="fa fa-check"></i><b>5.2</b> Implementing calibration</a></li>
<li class="chapter" data-level="5.3" data-path="calibration.html"><a href="calibration.html#testing-results-from-raked-weights"><i class="fa fa-check"></i><b>5.3</b> Testing results from raked weights</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="weight-variability.html"><a href="weight-variability.html"><i class="fa fa-check"></i><b>6</b> Step 4: Analysis of weight variability</a></li>
<li class="chapter" data-level="7" data-path="computing-estimates.html"><a href="computing-estimates.html"><i class="fa fa-check"></i><b>7</b> Computing weighted estimates</a></li>
<li class="chapter" data-level="8" data-path="note-for-non-probability-samples.html"><a href="note-for-non-probability-samples.html"><i class="fa fa-check"></i><b>8</b> Note for non-probability samples</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">(Very) basic steps to weight a survey sample</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="import_data_management" class="section level1">
<h1><span class="header-section-number">2</span> Import data and data management</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RCurl)
<span class="kw">library</span>(MASS)
<span class="kw">library</span>(glmnet)
<span class="kw">library</span>(caret)
<span class="kw">library</span>(survey)
<span class="kw">library</span>(readxl)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(forcats)
<span class="kw">library</span>(foreign)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(tidyverse)
<span class="kw">options</span>(<span class="dt">scipen =</span> <span class="dv">9999</span>)
<span class="kw">options</span>(<span class="dt">dplyr.width =</span> <span class="ot">Inf</span>)


<span class="kw">set.seed</span>(<span class="dv">456162</span>)</code></pre></div>
<p>We first need to import data into R. In this guide we will use UK data from the 7th round of the <a href="http://www.europeansocialsurvey.org/">European Social Survey</a>. The advantage of this data is that the European Social Survey (ESS) is a well documented and high quality probability survey. It allows us to understand how responses were collected and provides some useful information about non-respondents. At the same time, the 7th ESS was weighted by expert statisticians. The process of the two phases of weighting they applied is explained in their <a href="http://www.europeansocialsurvey.org/methodology/ess_methodology/data_processing_archiving/weighting.html">website</a>. This will allow us to compare our own weights and results with those already computed by their team of experts. Focusing on the UK sample will allow us to narrow down the analysis and fasten computation by reducing the amount of data used in each step.</p>
<p>For this guide we will use the following 7th ESS datafiles in SPSS (‘.sav’) format:</p>
<ul>
<li><a href="http://www.europeansocialsurvey.org/download.html?file=ESS7SDDFe01_1&amp;y=2014">sample data (SDDF), edition 1.1</a>, which contains the probability of being sampled for all respondents and non-respondents invited to the survey;<br />
</li>
<li><a href="http://www.europeansocialsurvey.org/download.html?file=ESS7CFe02_1&amp;y=2014">the data from Contact forms, edition 2.1</a>, which provides information about the process of data collection (e.g. number of times the person was approached for a response, ID of interviewer in each approach, conditions of the house/area where the potential respondent lived.). We will call this data the <em>‘paradata’</em> of the survey;</li>
<li><a href="http://www.europeansocialsurvey.org/download.html?file=ESS7INTe02_1&amp;y=2014">the integrated interviewer data file, edition2.1</a>. These are the responses to the survey.</li>
</ul>
<p>The following sections explain data import, selection, merging and recoding. Readers who are not interested in technical details about datasets can skip them and jump directly into <a href="#exploring%20and%20presenting%20the%20dataset">exploration and presentation of the data</a></p>
<div id="import-data" class="section level3">
<h3><span class="header-section-number">2.0.1</span> Import data</h3>
<p>The following chunk of code loads the data sets from a <em>data</em> folder in the working directory. The sample data file is stored into the <em>sample.data</em> ‘data_frame’ object. The contact forms information is stored into the <em>paradata</em> folder. Survey responses from the integrated interviewer file are saved in the <em>responses</em> object. We also store the weight variables included in the integrated interviewer file in the <em>original.weights</em> data_frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample.data &lt;-<span class="st"> </span><span class="kw">read.spss</span>(<span class="st">&quot;data/ESS7SDDFe1_1.sav&quot;</span>, <span class="dt">to.data.frame =</span> T)  %&gt;%
<span class="st">  </span><span class="kw">filter</span>(cntry ==<span class="st"> &quot;United Kingdom&quot;</span>)

paradata &lt;-<span class="st"> </span><span class="kw">read.spss</span>(<span class="st">&quot;data/ess7CFe02_1.sav&quot;</span>, <span class="dt">to.data.frame =</span> T) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(cntry ==<span class="st"> &quot;United Kingdom&quot;</span>) 

responses &lt;-<span class="st"> </span><span class="kw">read.spss</span>(<span class="st">&quot;data/ESS7e02_1.sav&quot;</span>, <span class="dt">to.data.frame =</span> T) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(cntry ==<span class="st"> &quot;United Kingdom&quot;</span>) 

original.weights &lt;-<span class="st"> </span>responses %&gt;%<span class="st"> </span><span class="kw">select</span>(idno ,dweight, pspwght, pweight)</code></pre></div>
</div>
<div id="select-variables" class="section level3">
<h3><span class="header-section-number">2.0.2</span> Select variables</h3>
<p>Once the data has been read into R, we select the variables we are going to use in our analysis. Selecting variables is a good practice as the ESS files contain much more information that we need for this example. This will allow us to easily find and see the data that is important for us in this guide. Here we just write the names of the variables we intend to use and we will later explain the content of these in more substantial terms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars.sample.data &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;idno&quot;</span>, <span class="st">&quot;psu&quot;</span>, <span class="st">&quot;prob&quot;</span>)

vars.paradata &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;idno&quot;</span>, <span class="st">&quot;typesamp&quot;</span>, <span class="st">&quot;interva&quot;</span>, <span class="st">&quot;telnum&quot;</span>, 
                   <span class="st">&quot;agea_1&quot;</span>, <span class="st">&quot;gendera1&quot;</span>, <span class="st">&quot;type&quot;</span>, <span class="st">&quot;access&quot;</span>, 
                   <span class="st">&quot;physa&quot;</span>, <span class="st">&quot;littera&quot;</span>, <span class="st">&quot;vandaa&quot;</span>)

resp.id &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;idno&quot;</span>)

resp.y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cgtsmke&quot;</span>, <span class="st">&quot;cgtsday&quot;</span>,
         <span class="st">&quot;alcfreq&quot;</span>, <span class="st">&quot;alcwkdy&quot;</span>, <span class="st">&quot;alcwknd&quot;</span>)

resp.x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;vote&quot;</span>, <span class="st">&quot;prtvtbgb&quot;</span>,
            <span class="st">&quot;prtclbgb&quot;</span>, <span class="st">&quot;prtdgcl&quot;</span>,
            <span class="st">&quot;ctzcntr&quot;</span>, <span class="st">&quot;ctzshipc&quot;</span>,
         <span class="st">&quot;brncntr&quot;</span>,<span class="st">&quot;cntbrthc&quot;</span>,
         <span class="st">&quot;gndr&quot;</span>, <span class="st">&quot;agea&quot;</span>, <span class="st">&quot;hhmmb&quot;</span>,<span class="st">&quot;eisced&quot;</span>, <span class="st">&quot;region&quot;</span>,
         <span class="st">&quot;pdwrk&quot;</span>, <span class="st">&quot;edctn&quot;</span>, <span class="st">&quot;uempla&quot;</span>, <span class="st">&quot;uempli&quot;</span>, <span class="st">&quot;rtrd&quot;</span>,
         <span class="st">&quot;wrkctra&quot;</span>, <span class="st">&quot;hinctnta&quot;</span>)</code></pre></div>
<p>We will also keep the variable labels from the SPSS (.sav) file, although these are not so common in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">selected.labels.sample.data &lt;-<span class="st"> </span><span class="kw">attributes</span>(sample.data)$variable.labels[<span class="kw">which</span>(<span class="kw">names</span>(sample.data) %in%<span class="st"> </span>vars.sample.data)]

selected.labels.paradata &lt;-<span class="st"> </span><span class="kw">attributes</span>(paradata)$variable.labels[<span class="kw">which</span>(<span class="kw">names</span>(paradata) %in%<span class="st"> </span>vars.paradata)]

selected.labels.responses &lt;-<span class="st"> </span><span class="kw">attributes</span>(responses)$variable.labels[<span class="kw">which</span>(<span class="kw">names</span>(responses) %in%<span class="st"> </span><span class="kw">c</span>(resp.y, resp.x))] 

<span class="kw">attributes</span>(responses)$variable.labels %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">cbind</span>(<span class="kw">names</span>(responses),.) %&gt;%<span class="st"> </span>
<span class="st">  </span>as_data_frame %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">write_csv</span>(<span class="st">&quot;interim_output/variable_labels.csv&quot;</span>)</code></pre></div>
<p>Now we do the selection of variables from the three data sets using the names of the variables written a couple of code chunks ago.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample.data %&lt;&gt;%<span class="st"> </span>
<span class="st">  </span>.[vars.sample.data]

paradata %&lt;&gt;%
<span class="st">  </span>.[vars.paradata]

responses %&lt;&gt;%
<span class="st">  </span>.[<span class="kw">which</span>(<span class="kw">names</span>(responses) %in%<span class="st"> </span><span class="kw">c</span>(resp.id, resp.y, resp.x))]</code></pre></div>
</div>
<div id="merging-datafiles" class="section level3">
<h3><span class="header-section-number">2.0.3</span> Merging datafiles</h3>
<p>After selecting the variables for the analysis, we merge the ‘paradata’ file containing all sampled units (respondents and non-respondents) with the ‘survey responses’ file, containing interview responses (only for respondents). The resulting data_frame is the ‘data’ object. It contains the ‘paradata’ information for all sampled individuals and responses for those that were interviewed successfully.</p>
<p>In a real situation where we collect the data ourselves we would also have a ‘survey frame’. This ‘survey frame’ would ideally include include all units from the population and characteristics of these such as stratification variables. A survey frame would include sampled units (respondents and non-respondents) as well as non-sampled units.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>paradata %&gt;%
<span class="st">  </span><span class="kw">left_join</span>(sample.data, <span class="dt">by =</span> <span class="st">&quot;idno&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">left_join</span>(responses, <span class="dt">by =</span> <span class="st">&quot;idno&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(interva) 

<span class="kw">rm</span>(paradata,
   sample.data,
   responses)</code></pre></div>
<p>Here we add the variable labels to the datasets with we kept before.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attributes</span>(data)$variable.labels &lt;-<span class="st"> </span><span class="kw">c</span>(selected.labels.paradata, selected.labels.sample.data[!<span class="kw">names</span>(selected.labels.sample.data) %in%<span class="st"> &quot;idno&quot;</span>],
                                      selected.labels.responses)</code></pre></div>
</div>
<div id="recoding" class="section level3">
<h3><span class="header-section-number">2.0.4</span> Recoding</h3>
<p>Here we will recode our two dependent variables: cigarette and alcohol consumption. All those respondents that don’t smoke should have a 0 in the <strong>cigarretes smoked per day</strong> variable. To calculate the <strong>alcohol consumption</strong> of respondents, we first calculate the daily consumption of alcohol if they were to consume alcohol daily and then weight by their stated frequency of alcohol consumption.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data$cgtsday[data$cgtsmke %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;I have never smoked&quot;</span>,
                                 <span class="st">&quot;I don&#39;t smoke now but I used to&quot;</span>,
                                 <span class="st">&quot;I have only smoked a few times&quot;</span>)] &lt;-<span class="st"> </span><span class="dv">0</span>

data$alcohol_day &lt;-<span class="st"> </span><span class="ot">NA</span> 
data$alcohol_day &lt;-<span class="st"> </span>(data$alcwkdy *<span class="st"> </span><span class="dv">5</span> +<span class="st"> </span>data$alcwknd *<span class="dv">2</span>)/<span class="dv">7</span> 

data$alcohol_day[<span class="kw">which</span>(data$alcfreq ==<span class="st"> &quot;Several times a week&quot;</span>)] &lt;-<span class="st"> </span>data$alcohol_day /<span class="st"> </span><span class="fl">2.5</span>
data$alcohol_day[<span class="kw">which</span>(data$alcfreq ==<span class="st"> &quot;Once a week&quot;</span>)] &lt;-<span class="st"> </span>data$alcohol_day/<span class="dv">7</span>
data$alcohol_day[<span class="kw">which</span>(data$alcfreq ==<span class="st"> &quot;2-3 times a month&quot;</span>)] &lt;-<span class="st"> </span>data$alcohol_day/<span class="dv">10</span>
data$alcohol_day[<span class="kw">which</span>(data$alcfreq ==<span class="st"> &quot;Once a month&quot;</span>)] &lt;-<span class="st"> </span>data$alcohol_day/<span class="dv">30</span>
data$alcohol_day[<span class="kw">which</span>(data$alcfreq ==<span class="st"> &quot;Less than once a month&quot;</span>)] &lt;-<span class="st"> </span>data$alcohol_day/<span class="dv">50</span>
data$alcohol_day[<span class="kw">which</span>(data$alcfreq ==<span class="st"> &quot;Never&quot;</span>)] &lt;-<span class="st"> </span><span class="dv">0</span>

resp.y &lt;-<span class="st"> </span><span class="kw">c</span>(resp.y, <span class="st">&quot;alcohol_day&quot;</span>)</code></pre></div>
</div>
<div id="exploring-and-presenting-the-dataset" class="section level2">
<h2><span class="header-section-number">2.1</span> Exploring and presenting the dataset</h2>
<p>The merged data set contains sampled <strong>respondents and non-respondents</strong>. It contains a total of 5600 units and 39 variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(data)</code></pre></div>
<pre><code>## [1] 5600   39</code></pre>
<p>The data set contains information about 2265 respondents and 3335 non-respondents.</p>
<p>And this is a list of the variables it contains (with their labels). <strong>idno</strong> is the individual identification variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data.variables &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">names</span>(data),<span class="kw">attributes</span>(data)$variable.labels) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">as_data_frame</span>()

data.variables$V2 &lt;-<span class="st"> </span><span class="kw">format</span>(data.variables$V2 , <span class="dt">justify =</span> <span class="st">&quot;left&quot;</span>)

data.variables %&gt;%
<span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">40</span>)</code></pre></div>
<pre><code>## # A tibble: 39 x 2
##             V1                                                                              V2
##          &lt;chr&gt;                                                                           &lt;chr&gt;
##  1        idno Respondent&#39;s identification number                                             
##  2    typesamp Type of the sample                                                             
##  3     interva Interview information for the sample unit                                      
##  4      telnum Telephone number                                                               
##  5      agea_1 Estimation of age of respondent or household member who refuses, by interviewer
##  6    gendera1 Gender of respondent or household member who refuses, recorded by interviewer  
##  7        type Type of house respondent lives in                                              
##  8      access Entry phone or locked gate/door before reaching respondent&#39;s individual door   
##  9       physa Assessment overall physical condition building/house                           
## 10     littera Amount of litter and rubbish in the immediate vicinity                         
## 11      vandaa Amount of vandalism and graffiti in the immediate vicinity                     
## 12         psu PSU                                                                            
## 13        prob PROB                                                                           
## 14        vote Voted last national election                                                   
## 15    prtvtbgb Party voted for in last national election, United Kingdom                      
## 16    prtclbgb Which party feel closer to, United Kingdom                                     
## 17     prtdgcl How close to party                                                             
## 18     ctzcntr Citizen of country                                                             
## 19    ctzshipc Citizenship                                                                    
## 20     brncntr Born in country                                                                
## 21    cntbrthc Country of birth                                                               
## 22     cgtsmke Cigarettes smoking behaviour                                                   
## 23     cgtsday How many cigarettes smoke on typical day                                       
## 24     alcfreq How often drink alcohol                                                        
## 25     alcwkdy Grams alcohol, last time drinking on a weekday, Monday to Thursday             
## 26     alcwknd Grams alcohol, last time drinking on a weekend day, Friday to Sunday           
## 27       hhmmb Number of people living regularly as member of household                       
## 28        gndr Gender                                                                         
## 29        agea Age of respondent, calculated                                                  
## 30      eisced Highest level of education, ES - ISCED                                         
## 31       pdwrk Doing last 7 days: paid work                                                   
## 32       edctn Doing last 7 days: education                                                   
## 33      uempla Doing last 7 days: unemployed, actively looking for job                        
## 34      uempli Doing last 7 days: unemployed, not actively looking for job                    
## 35        rtrd Doing last 7 days: retired                                                     
## 36     wrkctra Employment contract unlimited or limited duration                              
## 37    hinctnta Household&#39;s total net income, all sources                                      
## 38      region Region                                                                         
## 39 alcohol_day Respondent&#39;s identification number</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(data.variables)</code></pre></div>
<p>The goal of this guide will be to to give UK population estimates for cigarette and alcohol consumption based on ESS respondents. These will be our <em>Y</em> variables or variables of interest. The idea is to give descriptives of the distribution of these two variables (such as quantiles and mean) and then a simple extrapolation and compute total cigarette and alcohol consumption for the whole UK.</p>
<p>These are our <em>Y</em> variables:</p>
<ul>
<li><strong>cgtsday</strong> : Number of cigarettes smoked on a typical day.</li>
<li><strong>alcohol_day</strong> : Grams of alcohol ingested on a daily basis. Computed in the <a href="import-data-management.html#recoding"><em>Recoding</em></a> section from the amount of alcohol drank last time during weekdays and weekend.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data[resp.y] %&gt;%
<span class="st">  </span><span class="kw">as_data_frame</span>() %&gt;%
<span class="st">  </span><span class="kw">print</span>()</code></pre></div>
<pre><code>## # A tibble: 5,600 x 6
##                            cgtsmke cgtsday              alcfreq alcwkdy alcwknd alcohol_day
##  *                          &lt;fctr&gt;   &lt;dbl&gt;               &lt;fctr&gt;   &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;
##  1             I have never smoked       0          Once a week       0       8  0.32653061
##  2                   I smoke daily      10          Once a week      48      96  8.81632653
##  3             I have never smoked       0 Several times a week      42       0  0.91428571
##  4             I have never smoked       0                Never      NA      NA  0.00000000
##  5                   I smoke daily      20    2-3 times a month      55       0  0.03265306
##  6 I don&#39;t smoke now but I used to       0 Several times a week      26      32 24.68571429
##  7 I don&#39;t smoke now but I used to       0          Once a week      17       0  0.13061224
##  8                   I smoke daily      15                Never      NA      NA  0.00000000
##  9             I have never smoked       0                Never      NA      NA  0.00000000
## 10                   I smoke daily      20 Several times a week      42     121 12.00000000
## # ... with 5,590 more rows</code></pre>
<div id="paradata-variables" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Paradata variables</h3>
<p>The 7th ESS survey contains variables which give information about the data collection process. First, we have some variables that come from the ‘sample data (SDDF)’ file. These contain info about the ‘primary sampling unit’ and the probability of each unit of being selected in the sample. These two variables are only available for respondents. In a real project we would most probably have to compute the probability of being sampled ourselves.</p>
<ul>
<li><strong>psu</strong>: This variable includes information on the primary sampling unit (PSU). In the UK this refers to the ‘postcode address file’.</li>
<li><strong>prob</strong>: Probability of being included in the sample (i.e. approached for survey).</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data[vars.sample.data] %&gt;%
<span class="st">  </span><span class="kw">as_data_frame</span>() %&gt;%
<span class="st">  </span><span class="kw">print</span>()</code></pre></div>
<pre><code>## # A tibble: 5,600 x 3
##         idno   psu          prob
##  *     &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1 100000003  9388 0.00020306164
##  2 100000005  9241 0.00020306164
##  3 100000008  9472 0.00020306164
##  4 100000009  9450 0.00005076541
##  5 100000010  9479 0.00010153082
##  6 100000012  9460 0.00010153082
##  7 100000015  9440 0.00010153082
##  8 100000016  9494 0.00020306164
##  9 100000017  9376 0.00010153082
## 10 100000020  9273 0.00010153082
## # ... with 5,590 more rows</code></pre>
<p>The 7th ESS also contains variables for all sampled units (i.e. respondents and non-respondents). These give information about the events that occurred during the data collection process. We will use these variables as covariates during the computation of <strong>Non-response weights</strong> in <a href="#nonresponse%20weights">step two</a>.</p>
<ul>
<li><strong>typesamp</strong>: Refers to the type of unit sampled. In the UK addresses were the final sampling units. In some other countries these were households and individual people.<br />
</li>
<li><strong>interva</strong>: Shows the final outcome of the contact. In the UK sample, only codes ‘Complete …’ and ‘No interview …’ were used for respondents and non-respondents respectively.</li>
<li><strong>telnum</strong>: The interviewed person gave his/her mobile phone to the interviewer.</li>
<li><strong>agea_1</strong>: Interviewer estimation of age of respondent or household member who refuses to give the interview.</li>
<li><strong>gendera1</strong>: Interviewer estimation of gender of respondent or household member who refuses to give the interview.</li>
<li><strong>type</strong>: Type of house sampled unit lives in.</li>
<li><strong>access</strong>: Entry phone or locked gate/door before reaching respondent’s individual door.</li>
<li><strong>physa</strong>: Interviewer assessment overall physical condition building/house.</li>
<li><strong>littera</strong>: Interviewer assessment of amount of litter and rubbish in the immediate vicinity.</li>
<li><strong>vandaa</strong>: Interviewer assessment of amount of vandalism and graffiti in the immediate vicinity.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data[vars.paradata] %&gt;%
<span class="st">  </span><span class="kw">head</span>(<span class="dv">6</span>)</code></pre></div>
<pre><code>##        idno typesamp                                    interva  telnum
## 1 100000003  Address Complete and valid interview related to CF Present
## 2 100000005  Address Complete and valid interview related to CF Present
## 3 100000008  Address Complete and valid interview related to CF Present
## 4 100000009  Address Complete and valid interview related to CF Present
## 5 100000010  Address Complete and valid interview related to CF Present
## 6 100000012  Address Complete and valid interview related to CF Present
##   agea_1 gendera1                             type                access
## 1   &lt;NA&gt;     &lt;NA&gt;      Single unit: Terraced house  No, neither of these
## 2   &lt;NA&gt;     &lt;NA&gt; Single unit: Semi-detached house  No, neither of these
## 3   &lt;NA&gt;     &lt;NA&gt;      Single unit: Terraced house Yes, locked gate/door
## 4   &lt;NA&gt;     &lt;NA&gt; Single unit: Semi-detached house  No, neither of these
## 5   &lt;NA&gt;     &lt;NA&gt;      Single unit: Terraced house  No, neither of these
## 6   &lt;NA&gt;     &lt;NA&gt;      Single unit: Terraced house  No, neither of these
##          physa             littera              vandaa
## 1 Satisfactory        Small amount None or almost none
## 2         Good None or almost none None or almost none
## 3         Good None or almost none None or almost none
## 4 Satisfactory        Large amount None or almost none
## 5 Satisfactory None or almost none None or almost none
## 6    Very good None or almost none None or almost none</code></pre>
</div>
<div id="survey-responses" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Survey responses</h3>
<p>Apart from the variables of interest (cigarette and alcohol consumption) our dataset has other variables obtained from survey responses. Obviously, these are only available for respondents. We will try to use some of these variables to calibrate the survey in <a href="calibration.html#calibration"><strong>Use of auxiliary data/calibration</strong> step</a>. Some of these variables are:</p>
<ul>
<li><strong>vote</strong>: Voted last national election (Yes/No)</li>
<li><strong>prtvtbgb</strong>: Party voted for in last national election</li>
<li><strong>prtclbgb</strong>: Which party feel closer to, United Kingdom</li>
<li><strong>prtdgcl</strong>: How close does the repondent feel to the party party from ‘prtclbgb’</li>
<li><strong>ctzcntr</strong>: Has UK citizenship (Yes/No)</li>
<li><strong>ctzshipc</strong>: Citizenship of respondent</li>
<li><strong>brncntr</strong>:Respondent born in the UK</li>
<li><strong>cntbrthc</strong>: Respondent country of birth</li>
<li><strong>gndr</strong>: Gender of respondent</li>
<li><strong>agea</strong>: Calculated age of respondent</li>
<li><strong>eisced</strong>: Highest level of education of respondent</li>
<li><strong>pdwrk</strong>: In paid work</li>
<li><strong>edctn</strong>: In education</li>
<li><strong>uempla</strong>: In unemployment, actively looking for a job</li>
<li><strong>uempli</strong>: In unemployment, not actively looking for a job</li>
<li><strong>rtrd</strong>: Retired</li>
<li><strong>wrkctra</strong>: Employment contract unlimited or limited duration</li>
<li><strong>hinctnta</strong>: Household’s total net income, all sources</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data[<span class="kw">c</span>(resp.id, resp.x)] %&gt;%
<span class="st">  </span><span class="kw">head</span>(<span class="dv">6</span>)</code></pre></div>
<pre><code>##        idno vote         prtvtbgb prtclbgb   prtdgcl ctzcntr ctzshipc
## 1 100000003  Yes Liberal Democrat     &lt;NA&gt;      &lt;NA&gt;     Yes     &lt;NA&gt;
## 2 100000005  Yes Liberal Democrat     &lt;NA&gt;      &lt;NA&gt;     Yes     &lt;NA&gt;
## 3 100000008  Yes           Labour   Labour Not close     Yes     &lt;NA&gt;
## 4 100000009  Yes           Labour     &lt;NA&gt;      &lt;NA&gt;     Yes     &lt;NA&gt;
## 5 100000010   No             &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;     Yes     &lt;NA&gt;
## 6 100000012   No             &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;     Yes     &lt;NA&gt;
##   brncntr cntbrthc   gndr agea hhmmb
## 1     Yes     &lt;NA&gt; Female   49     1
## 2     Yes     &lt;NA&gt; Female   45     2
## 3     Yes     &lt;NA&gt;   Male   76     1
## 4      No     &lt;NA&gt;   Male   50     5
## 5     Yes     &lt;NA&gt;   Male   67     2
## 6     Yes     &lt;NA&gt; Female   31     2
##                                                eisced
## 1 ES-ISCED V2, higher tertiary education, &gt;= MA level
## 2     ES-ISCED V1, lower tertiary education, BA level
## 3              ES-ISCED I , less than lower secondary
## 4                        ES-ISCED II, lower secondary
## 5              ES-ISCED I , less than lower secondary
## 6           ES-ISCED IIIa, upper tier upper secondary
##                     region      pdwrk      edctn     uempla     uempli
## 1  West Midlands (England)     Marked Not marked Not marked Not marked
## 2                 Scotland     Marked Not marked Not marked Not marked
## 3  East Midlands (England) Not marked Not marked Not marked Not marked
## 4     South East (England) Not marked Not marked Not marked Not marked
## 5 Yorkshire and the Humber Not marked Not marked Not marked Not marked
## 6     South West (England)     Marked Not marked Not marked Not marked
##         rtrd     wrkctra       hinctnta
## 1 Not marked   Unlimited M - 4th decile
## 2 Not marked No contract R - 2nd decile
## 3     Marked   Unlimited R - 2nd decile
## 4 Not marked   Unlimited S - 6th decile
## 5     Marked        &lt;NA&gt; J - 1st decile
## 6 Not marked   Unlimited F - 5th decile</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="design-weights.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
